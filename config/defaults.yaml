# Thresholds & weights for the (no-ML) rule engine and module configs.
# You can override any field via --config <your.yaml>

app:
  name: pixspector
  save_visuals: true
  max_image_dim: 4096 # images larger than this will be downscaled for analysis (aspect preserved)
  tile_size: 128 # default tile size for patch-based analyses

sandbox:
  enabled: true
  max_file_size_mb: 50
  max_decode_pixels: 50000000
  max_memory_mb: 512
  max_cpu_seconds: 5
  worker_timeout_seconds: 10

rules:
  # AI-focused weights based on research
  weights:
    # AI Detection (Primary)
    ai_detection_high: 45
    ai_detection_medium: 30
    ai_detection_low: 15
    ai_pixel_distribution: 25
    ai_pixel_distribution_moderate: 12
    ai_spectral_anomaly: 20
    ai_texture_inconsistency: 18
    watermark_hit_high: 40
    watermark_hit_moderate: 22
    watermark_hit_low: 10

    # Traditional forensics (Secondary)
    ela_strong: 8
    ela_moderate: 4
    jpeg_double_misaligned: 10
    jpeg_double_aligned: 5
    dct_benford_strong: 15
    dct_benford_moderate: 8
    resampling_periodicity_strong: 12
    resampling_periodicity_moderate: 6
    cfa_inconsistency_large: 12
    cfa_inconsistency_small: 6
    prnu_mismatch: 8
    fft_periodic_spikes: 5

    # Provenance (Negative weights)
    provenance_c2pa_valid: -35
    provenance_exif_consistent: -12

  # Clamp final score to [0, 100]
  clamp_min: 0
  clamp_max: 100

  # Minimum overall AI probability required before individual AI component
  # evidence contributes to the suspicion index.
  ai_component_gate: 0.4

  # Adjusted buckets for AI detection
  buckets:
    low:
      max: 20
      label: "Low"
    medium:
      max: 45
      label: "Medium"
    high:
      max: 100
      label: "High"

modules:
  ela:
    recompress_quality: 90 # Back to standard value
    blur_sigma: 0.0

  jpeg_ghosts:
    q_grid: [60, 70, 80, 85, 90, 95] # Standard range
    diff_metric: "l1"
    misalign_window: 8

  dct_benford:
    min_blocks: 256 # Back to standard
    strong_z: 2.5 # Balanced sensitivity
    moderate_z: 1.8

  resampling:
    patch: 128 # Back to standard
    stride: 64
    radon_angles: 30
    periodicity_threshold_strong: 0.35 # Standard thresholds
    periodicity_threshold_moderate: 0.25

  cfa:
    patch: 64 # Back to standard
    stride: 32
    inconsistency_threshold_strong: 0.35 # Standard thresholds
    inconsistency_threshold_moderate: 0.25

  prnu:
    wavelet_denoise_sigma: 3.0
    correlate_min_nz: 0.05

  fft_checks:
    radial_bins: 64
    peak_prominence: 6.0
    highfreq_rolloff_warn: 0.75

  # Add AI detection configuration
  ai_detection:
    pixel_analysis: true
    spectral_analysis: true
    texture_analysis: true
    gradient_analysis: true
    color_analysis: true
